<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet id="1" author="badape">

        <createTable tableName="hero_base">
            <column name="hero_id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="game_id" type="bigint">
                <constraints unique="true" nullable="false"/>
            </column>
            <column name="health" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="mana" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="stamina" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="spawn_cost" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="roster">
            <column name="roster_id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="player_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="hero_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="level" type="bigint" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="experience" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="kills" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="deaths" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="resources" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="account">
            <column name="player_id" type="bigint" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="experience" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="kills" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="deaths" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="matches_won" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="matches_lost" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="resources" type="bigint" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="roster"
                                 baseColumnNames="player_id"
                                 constraintName="player_id_fkey"
                                 referencedTableName="account"
                                 referencedColumnNames="player_id"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"/>

        <addForeignKeyConstraint baseTableName="roster"
                                 baseColumnNames="hero_id"
                                 constraintName="hero_id_fkey"
                                 referencedTableName="hero_base"
                                 referencedColumnNames="hero_id"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"/>

        <createIndex catalogName="catalog" indexName="idx_hero_id" tableName="hero_base" unique="true">
            <column name="hero_id"/>
        </createIndex>


        <addUniqueConstraint columnNames="player_id, hero_id" constraintName="unique_roster_hero" tableName="roster"/>
    </changeSet>

</databaseChangeLog>